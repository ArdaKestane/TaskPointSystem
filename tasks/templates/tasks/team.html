{% extends "tasks/base.html" %}

{% block content %}
<div class="row team-main-row">
    <div class="col-sm-6 user-feed">
        <div class="team-dev-name">
            <h2>{{ developer_name }}</h2>
        </div>
        <hr>
        <div class="row your-active-tasks-row pad-b-10">
            <div class="col-sm-5 your-active-tasks-header">
                <h3>Your Active Tasks</h3>
            </div>
            <div class="col-sm-7">
                <div class="team-active-task-buttons float-right">
                    <a href="{% url 'tasks:team-points' team_id %}" class="btn btn-info" role="button">View Points</a>
                    <a href="{% url 'tasks:task-create-developer' team_id %}" class="btn btn-info" role="button">Create a task</a>
                    <a href="{% url 'tasks:task-all' team_id 'due' %}" class="btn btn-info" role="button">View All Tasks</a>
                </div>
            </div>
        </div>
        {% if user_task_list %}
            <div class="your-active-tasks">
                <ul>
                    {% for task in user_task_list %}
                        <a href="{% url 'tasks:view-task' task.id %}" role="button" style="text-decoration: none; color: #1A1A1A">
                            <li>
                                <p class="task-date"><span class="bold-span">Due: </span>{{ task.due }}</p>
                                <div class="task-header">
                                    <h4>{{ task.title }}</h4>
                                    <p><span class="bold-span">Status: </span>{{ task.get_status_display }}</p>
                                </div>
                                <hr class="content-separator">
                                <div class="task-content">
                                    <p class="content-text">{{ task.description }}</p>
                                </div>
                            </li>
                        </a>
                    {% endfor %}
                </ul>
            </div>
        {% else %}
            <p>You don't have any tasks assigned to you.</p>
        {% endif %}
    </div>
    <div class="col-sm-6 user-feed">
        <div class="team-dev-name">
            <h2>{{ team_name }}</h2>
        </div>
        <hr>
        <div class="row team-member-header pad-b-10">
            <div class="col-sm-4">
                <h3 style="float: left">Team Members</h3>
            </div>
            <div class="col-sm-8">
                <div class="float-right rename-team-div">
                    <a id="rename-team" class="btn btn-info" type="button">Rename Team</a>
                </div>
            </div>
            <div class="modal fade" tabindex="-1" role="dialog" id="modal" data-backdrop="false">
                <div class="modal-dialog" role="document">
                    <div class="modal-content"></div>
                </div>
            </div>
        </div>
        <div class="team-accordion">
            {% for mate, tasks in teammates_task_dict.items %}
                <button class="accordion">{{ mate }}</button>
                <ul>
                {% for mate_task in tasks %}
                    <div class="panel">
                         <a href="{% url 'tasks:view-task' mate_task.id %}" style="text-decoration: none; color: #1A1A1A">
                            <li>
                                <p class="task-date"><span class="bold-span">Due: </span>{{ mate_task.due }}</p>
                                <div class="task-header">
                                    <h4>{{ mate_task.title }}</h4>
                                    <p><span class="bold-span">Status: </span>{{ mate_task.get_status_display }}</p>
                                </div>
                                <hr class="content-separator">
                                <div class="task-content">
                                    <p class="content-text">{{ mate_task.description }}</p>
                                </div>
                            </li>
                         </a>
                    </div>
                {% endfor %}
                </ul>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
{% block scriptcontent %}
<script>
    const renameTeamButton$ = $('#rename-team');
    const renameTeamButtonDiv$ = $('.rename-team-div');
    const activeTaskButtons$ = $('.team-active-task-buttons');
    const name_change_count = '{{ name_change_count }}';

    $(function() {
        if( name_change_count > 3) {
            renameTeamButton$.removeClass('btn btn-info');
            renameTeamButton$.addClass('btn btn-secondary');
            renameTeamButton$.prop('title', "Your team's name was already changed the limit of 3 times");
            renameTeamButton$.attr('disabled', 'disabled');
            renameTeamButton$.css('cursor', 'context-menu');
        } else{
            renameTeamButton$.modalForm({
                formURL: "{% url 'tasks:rename-team' team_id %}"
            });
        }

        if (window.innerWidth < 1570) {
            activeTaskButtons$.removeClass('float-right');
            renameTeamButtonDiv$.removeClass('float-right');
        }
    });

    $(window).on('resize', function () {
        if (window.innerWidth < 1570) {
            activeTaskButtons$.removeClass('float-right');
            renameTeamButtonDiv$.removeClass('float-right');
        } else {
            activeTaskButtons$.addClass('float-right');
            renameTeamButtonDiv$.addClass('float-right');
        }
    });
</script>
{% endblock %}

